generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String         @id @default(uuid())
  email     String         @unique
  name      String
  password  String
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  configs   Configuracao[]
  meses     Mes[]

  @@map("users")
}

model Mes {
  id        String     @id @default(uuid())
  ano       Int
  mes       Int
  ativo     Boolean    @default(false)
  createdAt DateTime   @default(now())
  userId    String
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  quinzenas Quinzena[]

  @@unique([ano, mes, userId])
  @@map("meses")
}

model Quinzena {
  id            String    @id @default(uuid())
  tipo          String
  saldoAnterior Float     @default(0)
  createdAt     DateTime  @default(now())
  mesId         String
  Despesa       Despesa[]
  parcelas      Parcela[]
  mes           Mes       @relation(fields: [mesId], references: [id], onDelete: Cascade)
  receitas      Receita[]

  @@unique([mesId, tipo])
  @@map("quinzenas")
}

model Receita {
  id         String   @id @default(uuid())
  descricao  String
  valor      Float
  tipo       String
  createdAt  DateTime @default(now())
  quinzenaId String
  quinzena   Quinzena @relation(fields: [quinzenaId], references: [id], onDelete: Cascade)

  @@map("receitas")
}

model Despesa {
  id                  String    @id @default(cuid())
  descricao           String
  valorTotal          Float
  parcelas            Int
  categoria           String
  observacao          String?
  ehParcelada         Boolean   @default(false)
  dataPrimeiraParcela DateTime?
  quinzenaId          String
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  quinzena            Quinzena  @relation(fields: [quinzenaId], references: [id], onDelete: Cascade)
  parcelasRelacao     Parcela[]

  @@map("despesas")
}

model Parcela {
  id             String    @id @default(uuid())
  numeroParcela  Int
  valorParcela   Float
  dataVencimento DateTime
  pago           Boolean   @default(false)
  valorPago      Float?
  dataPagamento  DateTime?
  despesaId      String
  quinzenaId     String
  despesa        Despesa   @relation(fields: [despesaId], references: [id], onDelete: Cascade)
  quinzena       Quinzena  @relation(fields: [quinzenaId], references: [id], onDelete: Cascade)

  @@unique([despesaId, numeroParcela])
  @@map("parcelas")
}

model Configuracao {
  id        String  @id @default(uuid())
  chave     String
  valor     String
  descricao String?
  userId    String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, chave])
  @@map("configuracoes")
}
