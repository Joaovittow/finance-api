generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String         @id @default(uuid())
  email     String         @unique
  name      String
  password  String
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  configs   Configuracao[]
  meses     Mes[]

  @@map("users")
}

model Mes {
  id            String    @id @default(uuid())
  ano           Int
  mes           Int
  ativo         Boolean   @default(false)
  createdAt     DateTime  @default(now())
  userId        String
  saldoAnterior Float     @default(0)
  despesas      Despesa[]
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  parcelas      Parcela[]
  receitas      Receita[]

  @@unique([ano, mes, userId])
  @@map("meses")
}

model Receita {
  id           String   @id @default(uuid())
  descricao    String
  valor        Float
  tipo         String   @default("fixa")
  createdAt    DateTime @default(now())
  mesId        String
  dataDeposito String?
  mes          Mes      @relation(fields: [mesId], references: [id], onDelete: Cascade)

  @@map("receitas")
}

model Despesa {
  id                  String    @id @default(cuid())
  descricao           String
  valorTotal          Float
  parcelas            Int
  categoria           String
  observacao          String?
  ehParcelada         Boolean   @default(false)
  dataPrimeiraParcela String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  mesId               String
  mes                 Mes       @relation(fields: [mesId], references: [id], onDelete: Cascade)
  parcelasRelacao     Parcela[]

  @@map("despesas")
}

model Parcela {
  id             String    @id @default(uuid())
  numeroParcela  Int
  valorParcela   Float
  dataVencimento String
  pago           Boolean   @default(false)
  valorPago      Float?
  dataPagamento  DateTime?
  despesaId      String
  mesId          String
  despesa        Despesa   @relation(fields: [despesaId], references: [id], onDelete: Cascade)
  mes            Mes       @relation(fields: [mesId], references: [id], onDelete: Cascade)

  @@unique([despesaId, numeroParcela])
  @@map("parcelas")
}

model Configuracao {
  id        String  @id @default(uuid())
  chave     String
  valor     String
  descricao String?
  userId    String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, chave])
  @@map("configuracoes")
}
